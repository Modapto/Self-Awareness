# Local Analytics Service

## Service Description

The LA Local Analytics Service is a data visualization and statistical analysis tool for industrial production data within the MODAPTO ecosystem. It provides a GUI for comparing execution time datasets generated by the SA1 Service, enabling operators to perform comparative analysis of component performance across different time periods.

**Purpose:** Enable visual comparison and statistical analysis of component execution time KPIs through an interactive GUI. The service processes JSON histogram data files to generate overlaid histograms, statistical summaries, and performance comparisons between two selected datasets.

## Input Data Format

**Source:** SA1 Service output (NDJSON format)

```json
{
  "Stage": "CELL_05",
  "Cell": "Ligne réducteur REDG",
  "PLC": "plc_100",
  "Module": "A21",
  "SubElement": "ROOT",
  "Component": "Ecr_A21_3_L_LOOP_OUT",
  "Variable": "diActualVitesse",
  "Variable_Type": "velocity",
  "Starting_date": "03-10-2025 08:00:00",
  "Ending_date": "03-10-2025 18:00:00",
  "Data_source": "InfluxDB",
  "Bucket": "Ligne_reducteur_REDG05",
  "Data_list": [2.29, 2.24, 2.23, 2.27, 2.28]
}
```

**Hierarchy Structure:**
```
Cell → Module → SubElement → Component → Variable
```

**Supported Variables:**
- `diActualVitesse` (velocity)
- `iActualCurrent` (current)

---

## API Endpoints

### 1. Get Filtering Options

**Endpoint:** `POST /filtering-options`

**Request (decoded):**
```json
[
  {
    "Stage": "CELL_05",
    "Cell": "Ligne réducteur REDG",
    "Module": "A21",
    "SubElement": "ROOT",
    "Component": "Ecr_A21_3_L_LOOP_OUT",
    "Variable": "diActualVitesse",
    "Data_list": [...]
  }
]
```

**Response (decoded):**
```json
{
  "filtering_options": [
    {
      "Cell": "Ligne réducteur REDG",
      "Module": "A21",
      "SubElement": "ROOT",
      "Component": "Ecr_A21_3_L_LOOP_OUT",
      "Variable": "diActualVitesse"
    }
  ]
}
```

### 2. Generate Histogram

**Endpoint:** `POST /generate-histogram`

**Request (decoded):**
```json
{
  "histogram_data": [...],
  "params1": {
    "Cell": "Ligne réducteur REDG",
    "Module": "A21",
    "SubElement": "ROOT",
    "Component": "Ecr_A21_3_L_LOOP_OUT",
    "Variable": "diActualVitesse",
    "Date": "03-10-2025 08:00:00"
  },
  "params2": {...},  // Optional for comparison
  "max_filter": 15   // Optional, 0 = no filter
}
```

**Response:** Base64-encoded PNG image

### 3. Health Check

**Endpoint:** `GET /health`

---

## Output Features

### Histogram Visualization
- Overlaid histograms (30 bins)
- Color-coded datasets (Blue/Green)
- Mean value lines

### Statistics Per Dataset
- Count, Mean, Median, Min, Max, Standard Deviation

---

## Dependencies

```
fastapi>=0.104.0
numpy>=1.24.0
pandas>=2.0.0
matplotlib>=3.7.0
pydantic>=2.0.0
```